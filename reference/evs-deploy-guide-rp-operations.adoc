---
sidebar: sidebar 
permalink: reference/evs-deploy-guide-rp-operations.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, netapp, ontap,amazon elastic vmware service 
summary: Amazon EVS とAmazon FSx for NetApp ONTAPを使用したNetAppディザスタリカバリの紹介。  NetApp Disaster Recovery を Amazon EVS およびAmazon FSx for NetApp ONTAPと組み合わせて使用​​することで、フェイルオーバーの実行、フェイルオーバーのテスト、リソースの更新、移行、スナップショットの即時作成、レプリケーション プランの無効化または有効化、古いスナップショットのクリーンアップ、スナップショットの調整、レプリケーション プランの削除、スケジュールの編集を行うことができます。 
---
= NetApp Disaster Recovery を使用してレプリケーション プラン操作を実行する
:allow-uri-read: 


[role="lead"]
NetApp Disaster Recovery を Amazon EVS およびAmazon FSx for NetApp ONTAPと併用して、フェイルオーバー、フェイルオーバーのテスト、リソースの更新、移行、今すぐスナップショットを作成する、レプリケーション プランの無効化/有効化、古いスナップショットのクリーンアップ、スナップショットの調整、レプリケーション プランの削除、スケジュールの編集などの操作を実行します。



== フェイルオーバー

実行する必要がある主な操作は、決して起こらないことを願う操作、つまり、オンプレミスの運用サイトで壊滅的な障害が発生した場合に DR (宛先) データセンターにフェールオーバーすることです。

フェイルオーバーは手動で開始されるプロセスです。

.フェイルオーバー操作にアクセスする手順
. NetAppコンソールの左側のナビゲーション バーから、*保護* > *ディザスタ リカバリ* を選択します。
. NetAppディザスタリカバリ メニューから、*レプリケーション プラン* を選択します。


.フェイルオーバーを実行する手順
. レプリケーションプランページで、レプリケーションプランのアクションオプションを選択します。image:icon-horizontal-dots.png["アクションメニューの水平ドット"] 。
. *フェイルオーバー*を選択します。
+
image:evs-rp-menu-failover.png["フェイルオーバーメニューオプション"]

. 実稼働 (保護) サイトにアクセスできない場合は、以前に作成したスナップショットをリカバリ イメージとして選択します。これを行うには、[選択] を選択します。
. リカバリに使用するバックアップを選択します。
. (オプション) レプリケーション プランの状態に関係なく、 NetApp Disaster Recovery でフェイルオーバー プロセスを強制するかどうかを選択します。これは最後の手段としてのみ行う必要があります。
. (オプション) 本番サイトが復旧された後に、 NetApp Disaster Recovery でリバース保護関係を自動的に作成するかどうかを選択します。
. 続行することを確認するには、「Failover」という単語を入力します。
. *フェイルオーバー*を選択します。
+
image:evs-rp-failover-dialog.png["フェイルオーバーダイアログボックス"]





== テストフェイルオーバー

テスト フェイルオーバーは、2 つの違いを除いてフェイルオーバーと似ています。

* 実稼働サイトは引き続きアクティブであり、すべての VM は引き続き期待どおりに動作しています。
* 実稼働 VM のNetApp Disaster Recovery 保護は継続されます。


これは、宛先サイトでネイティブのONTAP FlexCloneボリュームを使用することで実現されます。テストフェイルオーバーの詳細については、以下を参照してください。link:../use/failover.html["リモートサイトへのアプリケーションのフェイルオーバー | NetAppドキュメント"] 。

テスト フェイルオーバーを実行する手順は、レプリケーション プランのコンテキスト メニューの [テスト フェイルオーバー] 操作を使用することを除いて、実際のフェイルオーバーを実行する手順と同じです。

.手順
. レプリケーションプランのアクションオプションを選択しますimage:icon-horizontal-dots.png["アクションメニューの水平ドット"]。
. メニューから*フェイルオーバーのテスト*を選択します。
+
image:evs-rp-menu-test-failover.png["テストフェイルオーバーメニューオプション"]

. 本番環境の最新の状態を取得するか（今すぐスナップショットを取得する）、以前に作成したレプリケーション プランのバックアップを使用するか（選択）を決定します。
. 以前に作成したバックアップを選択した場合は、リカバリに使用するバックアップを選択します。
. 続行するかどうかを確認するには、「Test failwold」という単語を入力します。
. *フェイルオーバーのテスト*を選択します。
+
image:evs-test-failover-dialog.png["テストフェイルオーバーダイアログボックス"]





== コンプライアンスチェックを実行する

コンプライアンス チェックは、デフォルトでは 3 時間ごとに実行されます。いつでも、コンプライアンス チェックを手動で実行する必要がある場合があります。

.手順
. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. レプリケーション プランの [アクション] メニューから [コンプライアンス チェックを実行] オプションを選択します。
+
image:evs-rp-menu-compliance-check.png["コンプライアンスチェックの実行メニューオプション"]

. NetApp Disaster Recovery がコンプライアンス チェックを自動的に実行する頻度を変更するには、レプリケーション プランの [アクション] メニューから [スケジュールの編集] オプションを選択します。




== リソースを更新する

VM の追加や削除、データストアの追加や削除、データストア間での VM の移動など、仮想インフラストラクチャに変更を加えるたびに、 NetApp Disaster Recovery サービスで影響を受ける vCenter クラスターの更新を実行する必要があります。デフォルトでは、このサービスは 24 時間に 1 回これを自動的に実行しますが、手動で更新すると、最新の仮想インフラストラクチャ情報が利用可能になり、DR 保護に考慮されるようになります。

更新が必要となるケースは 2 つあります。

* vCenter の更新: vCenter クラスターに VM が追加、削除、または移動されるたびに、vCenter の更新を実行します。
* レプリケーション プランの更新: 同じソース vCenter クラスタ内のデータストア間で VM が移動されるたびに、レプリケーション プランの更新を実行します。


image::evs-rp-menu-refresh-resources.png[リソースメニューオプションの更新]



== 移行

NetApp Disaster Recovery は主に災害復旧のユースケースに使用されますが、VM セットをソース サイトから宛先サイトに 1 回だけ移動することもできます。これは、クラウド プロジェクトへの協調的な移行のため、または悪天候、政治的紛争、その他の潜在的な一時的な大惨事などの災害回避のために使用される可能性があります。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. レプリケーション プラン内の VM を宛先の Amazon EVS クラスターに移動するには、レプリケーション プランの [アクション] メニューから [*移行*] を選択します。
+
image::evs-rp-menu-migrate.png[移行メニューオプション]

. 移行ダイアログ ボックスに情報を入力します。




== 今すぐスナップショットを撮る

いつでも、レプリケーション プランの即時スナップショットを取得できます。このスナップショットは、レプリケーション プランのスナップショット保持数によって設定されるNetAppディザスタ リカバリの考慮事項に含まれます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. レプリケーション プランのリソースのスナップショットをすぐに取得するには、レプリケーション プランの [アクション] メニューで [今すぐスナップショットを取得] を選択します。
+
image::evs-rp-menu-take-snapshot-now.png[今すぐスナップショットを撮るメニューオプション]





== レプリケーションプランを無効または有効にする

レプリケーション プロセスに影響を及ぼす可能性のある操作やメンテナンスを実行するために、レプリケーション プランを一時的に停止する必要がある場合があります。このサービスは、レプリケーションを停止および開始する方法を提供します。

. レプリケーションを一時的に停止するには、レプリケーション プランの [アクション] メニューで [無効] を選択します。
. レプリケーションを再開するには、レプリケーション プランの [アクション] メニューで [*有効*] を選択します。
+
レプリケーション プランがアクティブな場合、[有効にする] コマンドはグレー表示されます。レプリケーション プランが無効になっている場合、[無効] コマンドはグレー表示されます。

+
image::evs-rp-menu-disable-enable.png[無効化/有効化メニューオプション]





== 古いスナップショットをクリーンアップする

ソース サイトと宛先サイトに保持されている古いスナップショットをクリーンアップする必要がある場合があります。これは、レプリケーション プランのスナップショット保持数が変更された場合に発生する可能性があります。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. これらの古いスナップショットを手動で削除するには、レプリケーション プランの [アクション] メニューから [古いスナップショットをクリーンアップ] を選択します。
+
image::evs-rp-menu-cleanup-old-snapshots.png[古いスナップショットをクリーンアップするメニューオプション]





== スナップショットを調整する

このサービスはONTAPボリューム スナップショットを調整するため、 ONTAPストレージ管理者は、サービスに知られることなく、 ONTAP System Manager、 ONTAP CLI、またはONTAP REST API を使用してスナップショットを直接削除できます。サービスは、宛先クラスター上に存在しないソース上のスナップショットを 24 時間ごとに自動的に削除します。ただし、これをオンデマンドで実行できます。この機能により、すべてのサイト間でスナップショットの一貫性を確保できます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. 宛先クラスターに存在しないスナップショットをソース クラスターから削除するには、レプリケーション プランの [アクション] メニューから [*スナップショットの調整*] を選択します。
+
image::evs-rp-menu-reconcile-snapshots.png[スナップショットの調整メニューオプション]





== レプリケーションプランを削除する

レプリケーション プランが不要になった場合は、削除できます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. レプリケーション プランを削除するには、レプリケーション プランのコンテキスト メニューから [削除] を選択します。
+
image::evs-rp-menu-delete.png[削除メニューオプション]





== スケジュールを編集する

テストフェイルオーバーとコンプライアンス チェックの 2 つの操作が定期的に自動的に実行されます。

. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. これら 2 つの操作のいずれかのスケジュールを変更するには、レプリケーション プランの [スケジュールの編集] を選択します。
+
image::evs-rp-menu-edit-schedules.png[スケジュール編集メニューオプション]





=== コンプライアンスチェック間隔を変更する

デフォルトでは、コンプライアンス チェックは 3 時間ごとに実行されます。これを 30 分から 24 時間までの任意の間隔に変更できます。

この間隔を変更するには、[スケジュールの編集] ダイアログ ボックスの [頻度] フィールドを変更します。

image::evs-rp-edit-compliance-check-schedule.png[コンプライアンスチェックスケジュール]



=== 自動テストフェイルオーバーをスケジュールする

テストフェイルオーバーは、デフォルトでは手動で実行されます。自動テストフェイルオーバーをスケジュールすることで、レプリケーション プランが期待どおりに実行されることを確認できます。テストフェイルオーバープロセスの詳細については、以下を参照してください。link:../use/failover.html["フェイルオーバープロセスをテストする"] 。

.テストフェイルオーバーをスケジュールする手順
. *アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]レプリケーション プランの横にあります。
. *フェイルオーバーの実行*を選択します。
. *スケジュールに従ってテストフェイルオーバーを実行する*チェックボックスをオンにします。
. (オプション) *スケジュールされたテストフェイルオーバーにオンデマンドスナップショットを使用する* をオンにします。
. 「繰り返し」ドロップダウンで間隔の種類を選択します。
. テストフェイルオーバーを実行するタイミングを選択する
+
.. 毎週: 曜日を選択
.. 月次: 月の日付を選択


. テストフェイルオーバーを実行する時刻を選択します
. 開始日を選択してください。
. サービスでテスト環境を自動的にクリーンアップするかどうか、またクリーンアップ プロセスを開始する前にテスト環境をどのくらいの時間実行するかを決定します。
. *保存*を選択します。
+
image::evs-rp-edit-schedule-test-failover.png[スケジュールテストフェイルオーバーの編集]


