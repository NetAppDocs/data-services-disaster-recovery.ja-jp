---
sidebar: sidebar 
permalink: use/failover.html 
keywords: disaster recovery, bluexp disaster recovery, failover, replicate, fail over, vmware, vcenter 
summary: NetApp Disaster Recovery は、災害復旧ワークフローを自動化するクラウドベースの災害復旧サービスです。 
---
= NetApp Disaster Recovery でアプリケーションをリモート サイトにフェイルオーバーする
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
災害が発生した場合は、プライマリのオンプレミス VMware サイトを別のオンプレミスの VMware サイトまたは VMware Cloud on AWS にフェイルオーバーします。必要に応じてフェイルオーバー プロセスをテストして、成功を確認できます。

*必要なNetAppコンソール ロール* 組織管理者、フォルダまたはプロジェクト管理者、ディザスタ リカバリ管理者、またはディザスタ リカバリ フェールオーバー管理者のロール。

link:../reference/dr-reference-roles.html["NetApp Disaster Recovery におけるユーザーの役割と権限について学習します"] 。https://docs.netapp.com/us-en/bluexp-setup-admin/reference-iam-predefined-roles.html["すべてのサービスに対するNetAppコンソールのアクセスロールについて学習します"^] 。

*このタスクについて*

フェイルオーバー中、ディザスタ リカバリでは最新のSnapMirrorスナップショット コピーが使用されます。または、ポイントインタイム スナップショットから特定のスナップショットを選択することもできます ( SnapMirrorの保持ポリシーに従って)。

ランサムウェア攻撃時など、最新のレプリカが侵害された場合は、ポイントインタイム オプションを使用します。  BlueXP disaster recoveryでは、利用可能なすべての時点が表示されます。

このプロセスは、運用サイトが正常かどうか、および重要なインフラストラクチャの障害以外の理由で災害復旧サイトへのフェイルオーバーを実行しているかどうかによって異なります。

* ソース vCenter またはONTAPクラスタにアクセスできない重大な本番サイトの障害: NetApp Disaster Recovery を使用すると、復元する利用可能なスナップショットを自由に選択できます。
* 運用環境は正常です: 「今すぐスナップショットを作成する」か、以前に作成したスナップショットを選択できます。


この手順では、レプリケーション関係を解除し、vCenter ソース VM をオフラインにして、ボリュームをディザスタ リカバリ vCenter のデータストアとして登録し、プランのフェールオーバー ルールを使用して保護された VM を再起動し、ターゲット サイトで読み取り/書き込みを有効にします。



== フェイルオーバープロセスをテストする

フェイルオーバーを開始する前に、プロセスをテストできます。テストでは仮想マシンはオフラインになりません。

フェイルオーバー テスト中に、 BlueXP disaster recoveryによって一時的に仮想マシンが作成されます。  BlueXP disaster recoveryは、 FlexCloneボリュームをバックアップする一時データストアを ESXi ホストにマップします。

このプロセスでは、オンプレミスのONTAPストレージまたは AWS の FSx for NetApp ONTAPストレージの追加の物理容量は消費されません。元のソース ボリュームは変更されず、災害復旧中でもレプリカ ジョブを続行できます。

テストが終了したら、*テストのクリーンアップ* オプションを使用して仮想マシンをリセットする必要があります。これは推奨されますが、必須ではありません。

テスト フェイルオーバー操作は、実稼働ワークロード、テスト サイトで使用されるSnapMirror関係、および正常に動作し続ける必要がある保護されたワークロードには影響しません。

テスト フェイルオーバーの場合、Disaster Recovery は次の操作を実行します。

* 宛先クラスタとSnapMirror関係の事前チェックを実行します。
* ターゲット サイトのONTAPクラスタ上の保護された各ONTAPボリュームに対して、選択したスナップショットから新しいFlexCloneボリュームを作成します。
* データストアが VMFS である場合は、iGroup を作成して各 LUN にマップします。
* ターゲット仮想マシンを vCenter 内に新しいデータストアとして登録します。
* リソース グループ ページでキャプチャされたブート順序に基づいて、ターゲット仮想マシンの電源をオンにします。
* 「アプリケーション整合性」と示されている VM 内のサポートされているデータベース アプリケーションを静止解除します。
* ソース vCenter およびONTAPクラスタがまだアクティブな場合は、逆方向のSnapMirror関係を作成し、フェイルオーバー状態中に行われた変更を元のソース サイトに複製します。


.手順
. ログイン https://console.netapp.com/["NetAppコンソール"^]。
. NetAppコンソールの左側のナビゲーションから、*保護* > *災害復旧* を選択します。
. NetAppディザスタリカバリ メニューから、*レプリケーション プラン* を選択します。
. レプリケーション プランを選択します。
. 右側で*アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]*フェイルオーバーのテスト*を選択します。
. テスト フェイルオーバー ページで、「テスト フェイルオーバー」と入力し、*テスト フェイルオーバー* を選択します。
. テストが完了したら、テスト環境をクリーンアップします。




== フェイルオーバーテスト後にテスト環境をクリーンアップする

フェイルオーバー テストが終了したら、テスト環境をクリーンアップする必要があります。このプロセスでは、テスト場所、FlexClone、および一時データストアから一時 VM が削除されます。

.手順
. NetAppディザスタリカバリ メニューから、*レプリケーション プラン* を選択します。
. レプリケーション プランを選択します。
. 右側で*アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]*フェールオーバー テストのクリーンアップ*を選択します。
. [テスト フェールオーバー] ページで、「フェールオーバーのクリーンアップ」と入力し、[*フェールオーバー テストのクリーンアップ*] を選択します。




== ソースサイトを災害復旧サイトにフェイルオーバーする

災害が発生した場合、FSx for NetApp ONTAPを使用して、プライマリのオンプレミス VMware サイトを別のオンプレミス VMware サイトまたは VMware Cloud on AWS にオンデマンドでフェイルオーバーします。

フェイルオーバー プロセスには次の操作が含まれます。

* ディザスタ リカバリでは、宛先クラスタとSnapMirror関係の事前チェックを実行します。
* 最新のスナップショットを選択した場合は、最新の変更を複製するためにSnapMirror更新が実行されます。
* ソース仮想マシンの電源がオフになっています。
* SnapMirror関係が解除され、ターゲット ボリュームが読み取り/書き込み可能になります。
* スナップショットの選択に基づいて、アクティブなファイル システムが指定されたスナップショット (最新または選択されたもの) に復元されます。
* レプリケーション プランでキャプチャされた情報に基づいて、データストアが作成され、VMware または VMC クラスターまたはホストにマウントされます。データストアが VMFS である場合は、iGroup を作成して各 LUN にマップします。
* ターゲット仮想マシンは、vCenter 内に新しいデータストアとして登録されます。
* ターゲット仮想マシンは、リソース グループ ページでキャプチャされたブート順序に基づいて電源がオンになります。
* ソース vCenter がまだアクティブな場合は、フェールオーバーされているすべてのソース側 VM の電源をオフにします。
* 「アプリケーション整合性」と示されている VM 内のサポートされているデータベース アプリケーションを静止解除します。
* ソース vCenter およびONTAPクラスタがまだアクティブな場合は、逆方向のSnapMirror関係を作成し、フェイルオーバー状態にある間に行われた変更を元のソース サイトに複製します。  SnapMirror関係はターゲット仮想マシンからソース仮想マシンに逆転されます。



TIP: フェイルオーバーが開始すると、災害復旧サイトの vCenter で復旧した VM (仮想マシン、ネットワーク、データストア) を確認できます。デフォルトでは、仮想マシンはワークロード フォルダーに回復されます。

.手順
. NetAppディザスタリカバリ メニューから、*レプリケーション プラン* を選択します。
. レプリケーション プランを選択します。
. 右側で*アクション*オプションを選択しますimage:../use/icon-horizontal-dots.png["NetApp Disaster Recovery サービスのアクション メニュー アイコン"]*フェイルオーバー*を選択します。
+
image:dr-plan-failover3.png["フェイルオーバーページ"]

. フェールオーバー ページで、今すぐスナップショットを開始するか、回復するデータストアのスナップショットを選択します。デフォルトは最新です。
+
フェイルオーバーが発生する前に、現在のソースのスナップショットが作成され、現在の宛先に複製されます。

. 通常はフェイルオーバーの発生を妨げるエラーが検出された場合でもフェイルオーバーを発生させる場合は、必要に応じて「*強制フェイルオーバー*」を選択します。
. オプションで、レプリケーション プランのフェイルオーバー後にサービスによってリバースSnapMirror保護関係が自動的に作成されないようにするには、[保護をスキップ] を選択します。これは、 NetApp Disaster Recovery 内でサイトをオンラインに戻す前に、復元されたサイトで追加の操作を実行する場合に役立ちます。
+

TIP: レプリケーション プランの [アクション] メニューから [リソースの保護] を選択すると、逆保護を確立できます。これにより、プラン内の各ボリュームに対して逆方向のレプリケーション関係を作成しようとします。保護が復元されるまで、このジョブを繰り返し実行できます。保護が復元されると、通常の方法でフェイルバックを開始できます。

. ボックスに「failover」と入力します。
. *フェイルオーバー*を選択します。
. 進行状況を確認するには、メニューで*ジョブ監視*を選択します。

