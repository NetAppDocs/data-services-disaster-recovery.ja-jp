---
sidebar: sidebar 
permalink: use/resource-group.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, replication plan, protection, disaster, recovery, virtual machines, vm 
summary: NetApp Disaster Recovery は、災害復旧ワークフローを自動化するクラウドベースの災害復旧サービスです。  vCenter サイトを追加したら、災害復旧またはレプリケーション プランを作成する準備が整います。 
---
= NetApp Disaster Recoveryで VM を整理するためのリソース グループを作成する
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
vCenter サイトを追加した後、VM またはデータストアを単一のユニットとして保護するためのリソース グループを作成できます。リソース グループを使用すると、依存する一連の VM を、要件を満たす論理グループに編成できます。たとえば、1 つのアプリケーションに関連付けられた VM をグループ化したり、同様の層を持つアプリケーションをグループ化したりすることができます。別の例として、グループには回復時に実行できる遅延ブート オーダーが含まれる場合があります。

*必要なNetApp Consoleロール* 組織管理者、フォルダまたはプロジェクト管理者、ディザスタ リカバリ管理者、またはディザスタ リカバリ アプリケーション管理者のロール。

link:../reference/dr-reference-roles.html["NetApp Disaster Recoveryにおけるユーザーの役割と権限について学習します"] 。https://docs.netapp.com/us-en/bluexp-setup-admin/reference-iam-predefined-roles.html["すべてのサービスに対するNetApp Consoleのアクセスロールについて学習します"^] 。

*このタスクについて*

VM 自体またはデータストア内の VM をグループ化できます。

次の方法を使用してリソース グループを作成できます。

* リソースグループオプションから
* 災害復旧またはレプリケーション プランを作成している間。ソース vCenter クラスターによってホストされている VM が多数ある場合は、レプリケーション プランの作成時にリソース グループを作成する方が簡単な場合があります。レプリケーションプランの作成中にリソースグループを作成する手順については、link:drplan-create.html["レプリケーションプランを作成する"] 。



TIP: 各リソース グループには、1 つ以上の VM またはデータストアを含めることができます。  VM は、レプリケーション プランに含めた順序に基づいて電源がオンになります。  VM またはデータストアをリソース グループ リスト内で上下にドラッグすることで、順序を変更できます。

.リソースグループについて
リソース グループを使用すると、VM またはデータストアを 1 つのユニットとして結合できます。

たとえば、POS アプリケーションでは、データベース、ビジネス ロジック、ストアフロント用に複数の VM が使用される場合があります。これらすべての VM を 1 つのリソース グループで管理できます。  VM の起動順序、ネットワーク接続、およびアプリケーションに必要なすべての VM の回復に関するレプリケーション プラン ルールを適用するリソース グループを設定します。

.どのように機能しますか?
NetApp Disaster Recovery は、リソース グループ内の VM をホストしている基盤となるONTAPボリュームと LUN を複製することで VM を保護します。これを行うには、システムはリソース グループ内の VM をホストしている各データ ストアの名前を vCenter に照会します。次に、 NetApp Disaster Recovery は、そのデータ ストアをホストしているソースONTAPボリュームまたは LUN を識別します。すべての保護は、 SnapMirrorレプリケーションを使用してONTAPボリューム レベルで実行されます。

リソース グループ内の VM が異なるデータ ストアでホストされている場合、 NetApp Disaster Recovery は次のいずれかの方法を使用して、 ONTAPボリュームまたは LUN のデータ整合性のあるスナップショットを作成します。

[cols="30,65a"]
|===
| FlexVolボリュームの相対的な位置 | スナップショットレプリカプロセス 


| 複数のデータストア - *同じ SVM* 内のFlexVolボリューム  a| 
* ONTAP整合性グループが作成されました
* 整合性グループのスナップショットを取得
* ボリュームスコープのSnapMirrorレプリケーションが実行される




| 複数のデータストア - *複数の SVM* 内のFlexVolボリューム  a| 
* ONTAP API: `cg_start` 。スナップショットを取得できるようにすべてのボリュームを静止し、すべてのリソース グループ ボリュームのボリューム スコープのスナップショットを開始します。
* ONTAP API: `cg_end` 。スナップショットが取得された後、すべてのボリューム上の I/O を再開し、ボリューム スコープのSnapMirrorレプリケーションを有効にします。


|===
リソース グループを作成するときは、次の点を考慮してください。

* データストアをリソース グループに追加する前に、まず VM の手動検出またはスケジュールされた検出を開始します。これにより、VM が検出され、リソース グループにリストされるようになります。手動検出を開始しないと、VM がリソース グループにリストされない可能性があります。
* データストアに少なくとも 1 つの VM があることを確認します。データストアに VM がない場合、Disaster Recovery はデータストアを検出しません。
* 単一のデータストアは、複数のレプリケーション プランによって保護されている VM をホストしないでください。
* 保護された VM と保護されていない VM を同じデータストアにホストしないでください。保護された VM と保護されていない VM が同じデータストアでホストされている場合、次の問題が発生する可能性があります。
+
** NetApp Disaster Recovery はSnapMirrorを使用し、システムがONTAPボリューム全体を複製するため、そのボリュームの使用容量がライセンスの考慮に使用されます。この場合、保護された VM と保護されていない VM の両方によって消費されるボリューム スペースがこの計算に含まれます。
** リソース グループとそれに関連付けられたデータストアを災害復旧サイトにフェイルオーバーする必要がある場合、保護されていない VM (リソース グループの一部ではないが、 ONTAPボリュームでホストされている VM) はフェイルオーバー プロセスによってソース サイトに存在しなくなり、その結果、ソース サイトで保護されていない VM に障害が発生します。また、 NetApp Disaster Recovery、フェールオーバー vCenter サイトで保護されていない VM を起動しません。


* VM を保護するには、VM をリソース グループに含める必要があります。


*ベスト プラクティス*: NetApp Disaster Recoveryを展開する前に VM を整理して、「データストアの無秩序な増加」を最小限に抑えます。保護が必要な VM をデータストアのサブセットに配置し、保護する必要のない VM をデータストアの別のサブセットに配置します。特定のデータストア上の VM が異なるレプリケーション プランによって保護されていないことを確認します。

.手順
. ログイン https://console.netapp.com/["NetApp Console"^]。
. NetApp Consoleの左側のナビゲーションから、*保護* > *災害復旧* を選択します。
. NetApp Disaster Recoveryメニューから、*リソース グループ* を選択します。
. *追加*を選択します。
. リソース グループの名前を入力します。
. VM が配置されているソース vCenter クラスタを選択します。
. 検索方法に応じて、*仮想マシン* または *データストア* のいずれかを選択します。
. *リソース グループの追加* タブを選択します。システムは、選択した vCenter クラスタ内のすべてのデータストアまたは VM を一覧表示します。  *データストア* を選択した場合、システムは選択した vCenter クラスタ内のすべてのデータストアを一覧表示します。  *仮想マシン* を選択した場合、システムは選択した vCenter クラスター内のすべての仮想マシンを一覧表示します。
. [リソース グループの追加] ページの左側で、保護する VM を選択します。
+
image:dr-resource-groups-add.png["リソース グループの追加ページを示すスクリーンショット"]

+
image:dr-resource-groups-datastores-add.png["リソース グループの追加ページを示すスクリーンショット"]

. 必要に応じて、各 VM をリスト内で上下にドラッグして、右側の VM の順序を変更します。  VM は、追加した順序に基づいて電源がオンになります。
. *追加*を選択します。

